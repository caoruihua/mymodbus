2025-05-16 16:38:19 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:19 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:19 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:20 DEBUG https://open.feishu.cn:443 "POST /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/search HTTP/1.1" 200 None  544
2025-05-16 16:38:20 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:21 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:21 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:22 DEBUG https://open.feishu.cn:443 "POST /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/search HTTP/1.1" 200 None  544
2025-05-16 16:38:22 INFO 用例ID：testcase/test_run1.py::test_data  18
2025-05-16 16:38:22 INFO 测试结果：passed  19
2025-05-16 16:38:22 INFO 故障表示：None  20
2025-05-16 16:38:22 INFO 异常：None  21
2025-05-16 16:38:22 INFO 用例耗时：1.0494509999989532  22
2025-05-16 16:38:22 INFO **************************************  23
2025-05-16 16:38:24 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:24 INFO Modbus 数据: None  42
2025-05-16 16:38:24 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f980beab60da00a81a39"}}  108
2025-05-16 16:38:24 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f980beab60da00a81a39"}, "previousDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:24 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f980beab60da00a81a39"}}  108
2025-05-16 16:38:24 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:24 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f980beab60da00a81a39"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:24 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f980beab60da00a81a39"}, "driverConnectionId": 1, "serverConnectionId": 12, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 3.9283999940380454, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:24.087Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 12, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f980beab60da00a81a39"}, "previousDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.003928399994038045>]>"}  108
2025-05-16 16:38:24 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.003928399994038045>]>", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f980beab60da00a81a39"}, "driverConnectionId": 1, "serverConnectionId": 12, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0006253000465221703}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.011235499987378716}  108
2025-05-16 16:38:24 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"pfTnBHHbSgOZsCkfRB8u3w==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 18467, "operationId": 18467, "driverConnectionId": 1, "serverConnectionId": 14, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "durationMS": 1.5399999999999998, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 18467, "operationId": 18467, "driverConnectionId": 1, "serverConnectionId": 14, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:24 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.003928399994038045>]>", "clientId": {"$oid": "6826f980beab60da00a81a39"}}  108
2025-05-16 16:38:24 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.003928399994038045>]>", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 4.140002420172095e-05}  108
2025-05-16 16:38:24 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"pfTnBHHbSgOZsCkfRB8u3w==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 6334, "operationId": 6334, "driverConnectionId": 1, "serverConnectionId": 14, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "durationMS": 0.657, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 6334, "operationId": 6334, "driverConnectionId": 1, "serverConnectionId": 14, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:24 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:24 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f980beab60da00a81a39"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:24 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f980beab60da00a81a39"}, "previousDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.003928399994038045>]>", "newDescription": "<TopologyDescription id: 6826f980beab60da00a81a39, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:24 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f980beab60da00a81a39"}}  108
2025-05-16 16:38:24 INFO MongoDB连接已关闭  87
2025-05-16 16:38:24 INFO MongoDB 数据: None  51
2025-05-16 16:38:24 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:24 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:24 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:26 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKuYRTxhLX4 HTTP/1.1" 200 109  544
2025-05-16 16:38:26 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:26 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data0]  18
2025-05-16 16:38:26 INFO 测试结果：failed  19
2025-05-16 16:38:26 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [78.80000000000001]}, 'Mongomysqlresult': '0.0', 'Mysql/Mongo': 'SOC', 'Title': '集群-SOC', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:26 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:26 INFO 用例耗时：4.379625400004443  22
2025-05-16 16:38:26 INFO **************************************  23
2025-05-16 16:38:28 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:28 INFO Modbus 数据: None  42
2025-05-16 16:38:28 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}}  108
2025-05-16 16:38:28 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}, "previousDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:28 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f984beab60da00a81a3a"}}  108
2025-05-16 16:38:28 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:28 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:28 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}, "driverConnectionId": 1, "serverConnectionId": 15, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 1.3717999681830406, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:28.515Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 15, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}, "previousDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0013717999681830406>]>"}  108
2025-05-16 16:38:28 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0013717999681830406>]>", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:28 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}, "driverConnectionId": 1, "serverConnectionId": 15, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0011125000310130417}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0017668000073172152}  108
2025-05-16 16:38:28 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"T7XsMUT6TsGWvqObJ3xu5Q==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 19169, "operationId": 19169, "driverConnectionId": 1, "serverConnectionId": 16, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "durationMS": 0.678, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 19169, "operationId": 19169, "driverConnectionId": 1, "serverConnectionId": 16, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:28 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0013717999681830406>]>", "clientId": {"$oid": "6826f984beab60da00a81a3a"}}  108
2025-05-16 16:38:28 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0013717999681830406>]>", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 3.319996176287532e-05}  108
2025-05-16 16:38:28 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"T7XsMUT6TsGWvqObJ3xu5Q==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 15724, "operationId": 15724, "driverConnectionId": 1, "serverConnectionId": 16, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "durationMS": 0.201, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 15724, "operationId": 15724, "driverConnectionId": 1, "serverConnectionId": 16, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:28 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:28 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f984beab60da00a81a3a"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:28 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}, "previousDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0013717999681830406>]>", "newDescription": "<TopologyDescription id: 6826f984beab60da00a81a3a, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:28 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f984beab60da00a81a3a"}}  108
2025-05-16 16:38:28 INFO MongoDB连接已关闭  87
2025-05-16 16:38:28 INFO MongoDB 数据: None  51
2025-05-16 16:38:28 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:28 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:28 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:30 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recYi7EnJ4 HTTP/1.1" 200 101  544
2025-05-16 16:38:30 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:30 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data1]  18
2025-05-16 16:38:30 INFO 测试结果：failed  19
2025-05-16 16:38:30 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [44.400000000000006]}, 'Mongomysqlresult': '864.0', 'Mysql/Mongo': 'BV', 'Title': '集群-系统电压', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:30 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:30 INFO 用例耗时：3.9886458000401035  22
2025-05-16 16:38:30 INFO **************************************  23
2025-05-16 16:38:32 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:32 INFO Modbus 数据: None  42
2025-05-16 16:38:32 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}}  108
2025-05-16 16:38:32 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}, "previousDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:32 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f988beab60da00a81a3b"}}  108
2025-05-16 16:38:32 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:32 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:32 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}, "driverConnectionId": 1, "serverConnectionId": 18, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 0.8572000078856945, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:32.500Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 18, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}, "previousDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0008572000078856945>]>"}  108
2025-05-16 16:38:32 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0008572000078856945>]>", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}, "driverConnectionId": 1, "serverConnectionId": 18, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.001309799961745739}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0023053999757394195}  108
2025-05-16 16:38:32 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"CJbBt+VaSMqnq69lOJgn8w==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 29358, "operationId": 29358, "driverConnectionId": 1, "serverConnectionId": 20, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "durationMS": 0.408, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 29358, "operationId": 29358, "driverConnectionId": 1, "serverConnectionId": 20, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:32 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0008572000078856945>]>", "clientId": {"$oid": "6826f988beab60da00a81a3b"}}  108
2025-05-16 16:38:32 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0008572000078856945>]>", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 3.5999983083456755e-05}  108
2025-05-16 16:38:32 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"CJbBt+VaSMqnq69lOJgn8w==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 26962, "operationId": 26962, "driverConnectionId": 1, "serverConnectionId": 20, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "durationMS": 0.196, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 26962, "operationId": 26962, "driverConnectionId": 1, "serverConnectionId": 20, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:32 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:32 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f988beab60da00a81a3b"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:32 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}, "previousDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0008572000078856945>]>", "newDescription": "<TopologyDescription id: 6826f988beab60da00a81a3b, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:32 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f988beab60da00a81a3b"}}  108
2025-05-16 16:38:32 INFO MongoDB连接已关闭  87
2025-05-16 16:38:32 INFO MongoDB 数据: None  51
2025-05-16 16:38:32 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:32 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:32 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:34 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuJCUc8lY1Lr HTTP/1.1" 200 109  544
2025-05-16 16:38:34 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:34 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data2]  18
2025-05-16 16:38:34 INFO 测试结果：failed  19
2025-05-16 16:38:34 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [656]}, 'Mongomysqlresult': '0', 'Mysql/Mongo': 'Bcc', 'Title': '集群-系统电流', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:34 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:34 INFO 用例耗时：3.859812700015027  22
2025-05-16 16:38:34 INFO **************************************  23
2025-05-16 16:38:36 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:36 INFO Modbus 数据: None  42
2025-05-16 16:38:36 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}}  108
2025-05-16 16:38:36 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}, "previousDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:36 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}}  108
2025-05-16 16:38:36 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:36 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:36 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}, "driverConnectionId": 1, "serverConnectionId": 21, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 0.595899997279048, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:36.376Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 21, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}, "previousDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.000595899997279048>]>"}  108
2025-05-16 16:38:36 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.000595899997279048>]>", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}, "driverConnectionId": 1, "serverConnectionId": 21, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0008934999932534993}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0018476000404916704}  108
2025-05-16 16:38:36 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"Sfjm2BMbQQWf6cg6uqlpAQ==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 5705, "operationId": 5705, "driverConnectionId": 1, "serverConnectionId": 23, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "durationMS": 0.388, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 5705, "operationId": 5705, "driverConnectionId": 1, "serverConnectionId": 23, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:36 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.000595899997279048>]>", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}}  108
2025-05-16 16:38:36 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.000595899997279048>]>", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 3.4999975468963385e-05}  108
2025-05-16 16:38:36 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"Sfjm2BMbQQWf6cg6uqlpAQ==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 28145, "operationId": 28145, "driverConnectionId": 1, "serverConnectionId": 23, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "durationMS": 0.17, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 28145, "operationId": 28145, "driverConnectionId": 1, "serverConnectionId": 23, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:36 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:36 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f98cbeab60da00a81a3c"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:36 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}, "previousDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.000595899997279048>]>", "newDescription": "<TopologyDescription id: 6826f98cbeab60da00a81a3c, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:36 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f98cbeab60da00a81a3c"}}  108
2025-05-16 16:38:36 INFO MongoDB连接已关闭  87
2025-05-16 16:38:36 INFO MongoDB 数据: None  51
2025-05-16 16:38:36 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:36 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:36 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:38 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKyYblOePGE HTTP/1.1" 200 109  544
2025-05-16 16:38:38 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:38 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data3]  18
2025-05-16 16:38:38 INFO 测试结果：failed  19
2025-05-16 16:38:38 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [98.7]}, 'Mongomysqlresult': '100.0', 'Mysql/Mongo': 'SOH', 'Title': '集群-SOH', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:38 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:38 INFO 用例耗时：3.871678699972108  22
2025-05-16 16:38:38 INFO **************************************  23
2025-05-16 16:38:40 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:40 INFO Modbus 数据: None  42
2025-05-16 16:38:40 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}}  108
2025-05-16 16:38:40 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}, "previousDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:40 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f990beab60da00a81a3d"}}  108
2025-05-16 16:38:40 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:40 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:40 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}, "driverConnectionId": 1, "serverConnectionId": 24, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 15.577399986796081, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:40.258Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 24, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}, "previousDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.015577399986796081>]>"}  108
2025-05-16 16:38:40 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.015577399986796081>]>", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}, "driverConnectionId": 1, "serverConnectionId": 24, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.007857999997213483}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.008954700024332851}  108
2025-05-16 16:38:40 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"PCi5cPvtTLiVKKhMy7CjJA==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 16827, "operationId": 16827, "driverConnectionId": 1, "serverConnectionId": 26, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "durationMS": 0.847, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 16827, "operationId": 16827, "driverConnectionId": 1, "serverConnectionId": 26, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:40 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.015577399986796081>]>", "clientId": {"$oid": "6826f990beab60da00a81a3d"}}  108
2025-05-16 16:38:40 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.015577399986796081>]>", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.740000728517771e-05}  108
2025-05-16 16:38:40 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"PCi5cPvtTLiVKKhMy7CjJA==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 9961, "operationId": 9961, "driverConnectionId": 1, "serverConnectionId": 26, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "durationMS": 0.46900000000000003, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 9961, "operationId": 9961, "driverConnectionId": 1, "serverConnectionId": 26, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:40 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:40 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f990beab60da00a81a3d"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:40 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}, "previousDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.015577399986796081>]>", "newDescription": "<TopologyDescription id: 6826f990beab60da00a81a3d, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:40 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f990beab60da00a81a3d"}}  108
2025-05-16 16:38:40 INFO MongoDB连接已关闭  87
2025-05-16 16:38:40 INFO MongoDB 数据: None  51
2025-05-16 16:38:40 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:40 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:40 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:42 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKzcdXodiKE HTTP/1.1" 200 109  544
2025-05-16 16:38:42 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:42 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data4]  18
2025-05-16 16:38:42 INFO 测试结果：failed  19
2025-05-16 16:38:42 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [0.029]}, 'Mongomysqlresult': '3.600', 'Mysql/Mongo': 'BVMax', 'Title': '集群-单体最高电压值', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:42 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:42 INFO 用例耗时：3.9418013999820687  22
2025-05-16 16:38:42 INFO **************************************  23
2025-05-16 16:38:44 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:44 INFO Modbus 数据: None  42
2025-05-16 16:38:44 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}}  108
2025-05-16 16:38:44 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}, "previousDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:44 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f994beab60da00a81a3e"}}  108
2025-05-16 16:38:44 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:44 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:44 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}, "driverConnectionId": 1, "serverConnectionId": 27, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 1.1828999849967659, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:44.191Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 27, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}, "previousDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0011828999849967659>]>"}  108
2025-05-16 16:38:44 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0011828999849967659>]>", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:44 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}, "driverConnectionId": 1, "serverConnectionId": 27, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0008675000281073153}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.002019300009123981}  108
2025-05-16 16:38:44 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"Y2tozNmaSP6L8BsmsLoSsQ==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 2995, "operationId": 2995, "driverConnectionId": 1, "serverConnectionId": 29, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "durationMS": 0.587, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 2995, "operationId": 2995, "driverConnectionId": 1, "serverConnectionId": 29, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:44 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0011828999849967659>]>", "clientId": {"$oid": "6826f994beab60da00a81a3e"}}  108
2025-05-16 16:38:44 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0011828999849967659>]>", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.359999628737569e-05}  108
2025-05-16 16:38:44 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"Y2tozNmaSP6L8BsmsLoSsQ==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 11942, "operationId": 11942, "driverConnectionId": 1, "serverConnectionId": 29, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "durationMS": 0.29, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 11942, "operationId": 11942, "driverConnectionId": 1, "serverConnectionId": 29, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:44 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:44 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f994beab60da00a81a3e"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:44 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}, "previousDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0011828999849967659>]>", "newDescription": "<TopologyDescription id: 6826f994beab60da00a81a3e, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:44 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f994beab60da00a81a3e"}}  108
2025-05-16 16:38:44 INFO MongoDB连接已关闭  87
2025-05-16 16:38:44 INFO MongoDB 数据: None  51
2025-05-16 16:38:44 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:44 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:44 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:46 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKzcf9CJGF9 HTTP/1.1" 200 109  544
2025-05-16 16:38:46 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:46 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data5]  18
2025-05-16 16:38:46 INFO 测试结果：failed  19
2025-05-16 16:38:46 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [0.067]}, 'Mongomysqlresult': '3.600', 'Mysql/Mongo': 'BVMin', 'Title': '集群-单体最低电压值', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:46 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:46 INFO 用例耗时：4.054601499985438  22
2025-05-16 16:38:46 INFO **************************************  23
2025-05-16 16:38:48 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:48 INFO Modbus 数据: None  42
2025-05-16 16:38:48 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}}  108
2025-05-16 16:38:48 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}, "previousDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:48 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f998beab60da00a81a3f"}}  108
2025-05-16 16:38:48 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:48 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:48 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}, "driverConnectionId": 1, "serverConnectionId": 30, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 0.4552999744191766, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:48.259Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 30, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}, "previousDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0004552999744191766>]>"}  108
2025-05-16 16:38:48 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0004552999744191766>]>", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}, "driverConnectionId": 1, "serverConnectionId": 30, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0029616000247187912}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0044994999771006405}  108
2025-05-16 16:38:48 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"wIV1WvVdSCyDyY83s8HGaA==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 5436, "operationId": 5436, "driverConnectionId": 1, "serverConnectionId": 32, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "durationMS": 0.982, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 5436, "operationId": 5436, "driverConnectionId": 1, "serverConnectionId": 32, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:48 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0004552999744191766>]>", "clientId": {"$oid": "6826f998beab60da00a81a3f"}}  108
2025-05-16 16:38:48 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0004552999744191766>]>", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00016250001499429345}  108
2025-05-16 16:38:48 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"wIV1WvVdSCyDyY83s8HGaA==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 32391, "operationId": 32391, "driverConnectionId": 1, "serverConnectionId": 32, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "durationMS": 0.447, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 32391, "operationId": 32391, "driverConnectionId": 1, "serverConnectionId": 32, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:48 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:48 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f998beab60da00a81a3f"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:48 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}, "previousDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0004552999744191766>]>", "newDescription": "<TopologyDescription id: 6826f998beab60da00a81a3f, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:48 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f998beab60da00a81a3f"}}  108
2025-05-16 16:38:48 INFO MongoDB连接已关闭  87
2025-05-16 16:38:48 INFO MongoDB 数据: None  51
2025-05-16 16:38:48 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:48 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:48 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:50 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKze9P9k8pG HTTP/1.1" 200 109  544
2025-05-16 16:38:50 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:50 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data6]  18
2025-05-16 16:38:50 INFO 测试结果：failed  19
2025-05-16 16:38:50 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [0.731]}, 'Mongomysqlresult': '3.600', 'Mysql/Mongo': 'BVAvg', 'Title': '集群-单体平均电压值', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:50 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:50 INFO 用例耗时：3.869472099991981  22
2025-05-16 16:38:50 INFO **************************************  23
2025-05-16 16:38:52 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:52 INFO Modbus 数据: None  42
2025-05-16 16:38:52 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}}  108
2025-05-16 16:38:52 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}, "previousDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:52 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}}  108
2025-05-16 16:38:52 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:52 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:52 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}, "driverConnectionId": 1, "serverConnectionId": 33, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 0.7933999877423048, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:52.146Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 33, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}, "previousDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007933999877423048>]>"}  108
2025-05-16 16:38:52 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007933999877423048>]>", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}, "driverConnectionId": 1, "serverConnectionId": 33, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0008046000148169696}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0018387999734841287}  108
2025-05-16 16:38:52 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"HUpjZ0VrRki3xR2U/dTr5w==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 3902, "operationId": 3902, "driverConnectionId": 1, "serverConnectionId": 35, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "durationMS": 0.499, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 3902, "operationId": 3902, "driverConnectionId": 1, "serverConnectionId": 35, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:52 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007933999877423048>]>", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}}  108
2025-05-16 16:38:52 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007933999877423048>]>", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.429998368024826e-05}  108
2025-05-16 16:38:52 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"HUpjZ0VrRki3xR2U/dTr5w==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 153, "operationId": 153, "driverConnectionId": 1, "serverConnectionId": 35, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "durationMS": 0.29500000000000004, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 153, "operationId": 153, "driverConnectionId": 1, "serverConnectionId": 35, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:52 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:52 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f99cbeab60da00a81a40"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:52 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}, "previousDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007933999877423048>]>", "newDescription": "<TopologyDescription id: 6826f99cbeab60da00a81a40, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:52 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f99cbeab60da00a81a40"}}  108
2025-05-16 16:38:52 INFO MongoDB连接已关闭  87
2025-05-16 16:38:52 INFO MongoDB 数据: None  51
2025-05-16 16:38:52 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:52 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:52 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:54 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKze9ZWG6ot HTTP/1.1" 200 109  544
2025-05-16 16:38:54 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:54 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data7]  18
2025-05-16 16:38:54 INFO 测试结果：failed  19
2025-05-16 16:38:54 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [692]}, 'Mongomysqlresult': '26', 'Mysql/Mongo': 'BTMax', 'Title': '集群-单体最高温度值', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:54 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:54 INFO 用例耗时：3.9304203999927267  22
2025-05-16 16:38:54 INFO **************************************  23
2025-05-16 16:38:56 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:38:56 INFO Modbus 数据: None  42
2025-05-16 16:38:56 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}}  108
2025-05-16 16:38:56 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}, "previousDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:56 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:56 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}}  108
2025-05-16 16:38:56 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:56 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}, "driverConnectionId": 1, "serverConnectionId": 36, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 0.5435000057332218, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:56.078Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 36, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}, "previousDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0005435000057332218>]>"}  108
2025-05-16 16:38:56 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0005435000057332218>]>", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:56 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}, "driverConnectionId": 1, "serverConnectionId": 36, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0005111999926157296}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0011006999993696809}  108
2025-05-16 16:38:56 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"PjueVC6PTxS6j2FdVvICtw==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 12382, "operationId": 12382, "driverConnectionId": 1, "serverConnectionId": 38, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "durationMS": 0.808, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 12382, "operationId": 12382, "driverConnectionId": 1, "serverConnectionId": 38, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:56 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0005435000057332218>]>", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}}  108
2025-05-16 16:38:56 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0005435000057332218>]>", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 4.789995728060603e-05}  108
2025-05-16 16:38:56 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"PjueVC6PTxS6j2FdVvICtw==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 17421, "operationId": 17421, "driverConnectionId": 1, "serverConnectionId": 38, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "durationMS": 0.313, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 17421, "operationId": 17421, "driverConnectionId": 1, "serverConnectionId": 38, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:56 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:56 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f9a0beab60da00a81a41"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:56 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}, "previousDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0005435000057332218>]>", "newDescription": "<TopologyDescription id: 6826f9a0beab60da00a81a41, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:56 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f9a0beab60da00a81a41"}}  108
2025-05-16 16:38:56 INFO MongoDB连接已关闭  87
2025-05-16 16:38:56 INFO MongoDB 数据: None  51
2025-05-16 16:38:56 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:56 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:56 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:59 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKzeadRQ9t4 HTTP/1.1" 200 109  544
2025-05-16 16:38:59 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:38:59 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data8]  18
2025-05-16 16:38:59 INFO 测试结果：failed  19
2025-05-16 16:38:59 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [683]}, 'Mongomysqlresult': '25', 'Mysql/Mongo': 'BTMin', 'Title': '集群-单体最低温度值', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:38:59 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:38:59 INFO 用例耗时：5.2324350999551825  22
2025-05-16 16:38:59 INFO **************************************  23
2025-05-16 16:38:59 INFO Modbus 数据: None  42
2025-05-16 16:38:59 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}}  108
2025-05-16 16:38:59 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}, "previousDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:59 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}}  108
2025-05-16 16:38:59 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "remainingTimeMS": 29999}  108
2025-05-16 16:38:59 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:38:59 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}, "driverConnectionId": 1, "serverConnectionId": 39, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 1.4874000335112214, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:38:59.307Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 39, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}, "previousDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0014874000335112214>]>"}  108
2025-05-16 16:38:59 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0014874000335112214>]>", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}, "driverConnectionId": 1, "serverConnectionId": 39, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0004070999566465616}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0011460999958217144}  108
2025-05-16 16:38:59 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"JGE48IbxTZCW5WBlmR/nEw==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 19718, "operationId": 19718, "driverConnectionId": 1, "serverConnectionId": 41, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "durationMS": 0.675, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 19718, "operationId": 19718, "driverConnectionId": 1, "serverConnectionId": 41, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:59 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0014874000335112214>]>", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}}  108
2025-05-16 16:38:59 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0014874000335112214>]>", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 3.63999861292541e-05}  108
2025-05-16 16:38:59 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"JGE48IbxTZCW5WBlmR/nEw==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 19895, "operationId": 19895, "driverConnectionId": 1, "serverConnectionId": 41, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "durationMS": 0.225, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 19895, "operationId": 19895, "driverConnectionId": 1, "serverConnectionId": 41, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:38:59 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:38:59 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f9a3beab60da00a81a42"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:38:59 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}, "previousDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0014874000335112214>]>", "newDescription": "<TopologyDescription id: 6826f9a3beab60da00a81a42, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:38:59 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f9a3beab60da00a81a42"}}  108
2025-05-16 16:38:59 INFO MongoDB连接已关闭  87
2025-05-16 16:38:59 INFO MongoDB 数据: None  51
2025-05-16 16:38:59 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:38:59 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:38:59 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:39:01 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKzeaEwpxwC HTTP/1.1" 200 109  544
2025-05-16 16:39:01 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:39:01 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data9]  18
2025-05-16 16:39:01 INFO 测试结果：failed  19
2025-05-16 16:39:01 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [12607.2]}, 'Mongomysqlresult': '25', 'Mysql/Mongo': 'BTAvg', 'Title': '集群-单体平均温度值', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:39:01 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:39:01 INFO 用例耗时：1.8618666999973357  22
2025-05-16 16:39:01 INFO **************************************  23
2025-05-16 16:39:03 ERROR Connection to (127.0.0.1, 501) failed: [WinError 10061] 由于目标计算机积极拒绝，无法连接。  200
2025-05-16 16:39:03 INFO Modbus 数据: None  42
2025-05-16 16:39:03 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}}  108
2025-05-16 16:39:03 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}, "previousDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:39:03 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}}  108
2025-05-16 16:39:03 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "remainingTimeMS": 29999}  108
2025-05-16 16:39:03 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false}  108
2025-05-16 16:39:03 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}, "driverConnectionId": 1, "serverConnectionId": 42, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 0.7443000213243067, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"68213eb23f5fa26e331d31c6\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-16T08:39:03.176Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 42, \"maxWireVersion\": 21, \"ok\": 1.0}"}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}, "previousDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007443000213243067>]>"}  108
2025-05-16 16:39:03 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007443000213243067>]>", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection created", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:39:03 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}, "driverConnectionId": 1, "serverConnectionId": 42, "serverHost": "localhost", "serverPort": 27017, "awaited": true}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0007455000304616988}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.001454999961424619}  108
2025-05-16 16:39:03 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "command": "{\"find\": \"RackDetail_TK4620306003-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"vrdn52rKQoi2HXz37/XbbQ==\", \"subType\": \"04\"}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 21726, "operationId": 21726, "driverConnectionId": 1, "serverConnectionId": 43, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "durationMS": 0.5289999999999999, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620306003-1\"}, \"ok\": 1.0}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 21726, "operationId": 21726, "driverConnectionId": 1, "serverConnectionId": 43, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:39:03 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007443000213243067>]>", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}}  108
2025-05-16 16:39:03 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007443000213243067>]>", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 3.2100011594593525e-05}  108
2025-05-16 16:39:03 DEBUG {"message": "Command started", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"vrdn52rKQoi2HXz37/XbbQ==\", \"subType\": \"04\"}}}], \"$db\": \"admin\"}", "commandName": "endSessions", "databaseName": "admin", "requestId": 14771, "operationId": 14771, "driverConnectionId": 1, "serverConnectionId": 43, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "durationMS": 0.189, "reply": "{\"ok\": 1.0}", "commandName": "endSessions", "databaseName": "admin", "requestId": 14771, "operationId": 14771, "driverConnectionId": 1, "serverConnectionId": 43, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-16 16:39:03 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-16 16:39:03 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6826f9a7beab60da00a81a43"}, "serverHost": "localhost", "serverPort": 27017}  108
2025-05-16 16:39:03 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}, "previousDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0007443000213243067>]>", "newDescription": "<TopologyDescription id: 6826f9a7beab60da00a81a43, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-16 16:39:03 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6826f9a7beab60da00a81a43"}}  108
2025-05-16 16:39:03 INFO MongoDB连接已关闭  87
2025-05-16 16:39:03 INFO MongoDB 数据: None  51
2025-05-16 16:39:03 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:39:03 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-16 16:39:03 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-16 16:39:05 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKA7ppsdeuf HTTP/1.1" 200 109  544
2025-05-16 16:39:05 INFO MongoDB 数据写入成功: None  54
2025-05-16 16:39:05 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data10]  18
2025-05-16 16:39:05 INFO 测试结果：failed  19
2025-05-16 16:39:05 INFO 故障表示：test_data = {'Expected_result': {'type': 2, 'value': [88]}, 'Mongomysqlresult': '-50', 'Mysql/Mongo': 'Bcp', 'Title': '集群-系统功率', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
        # 测试逻辑
        print(type(test_data))
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
    
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'dict'

test_run1.py:59: TypeError  20
2025-05-16 16:39:05 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'dict'") tblen=27>  21
2025-05-16 16:39:05 INFO 用例耗时：3.8339954999973997  22
2025-05-16 16:39:05 INFO **************************************  23
