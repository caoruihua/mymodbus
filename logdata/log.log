2025-05-27 17:06:29 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:06:29 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:06:29 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:06:30 DEBUG https://open.feishu.cn:443 "POST /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/search HTTP/1.1" 200 None  544
2025-05-27 17:06:30 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:06:30 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:06:30 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:06:31 DEBUG https://open.feishu.cn:443 "POST /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/search HTTP/1.1" 200 None  544
2025-05-27 17:06:31 INFO 用例ID：testcase/test_run1.py::test_data  18
2025-05-27 17:06:31 INFO 测试结果：passed  19
2025-05-27 17:06:31 INFO 故障表示：None  20
2025-05-27 17:06:31 INFO 异常：None  21
2025-05-27 17:06:31 INFO 用例耗时：1.1879175000067335  22
2025-05-27 17:06:31 INFO **************************************  23
2025-05-27 17:06:31 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 58632)  195
2025-05-27 17:06:31 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x22 0x3 0x14  91
2025-05-27 17:06:31 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=34, count=0, bits=[], registers=[788], status=1)   113
2025-05-27 17:06:31 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:06:31 INFO Modbus 数据: None  67
2025-05-27 17:06:31 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "683580972dc57aec88079d41"}}  108
2025-05-27 17:06:31 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "previousDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:06:31 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:06:31 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:06:31 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:06:31 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:06:31 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683580972dc57aec88079d41"}}  108
2025-05-27 17:06:31 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683580972dc57aec88079d41"}, "remainingTimeMS": 29999}  108
2025-05-27 17:06:54 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:06:54 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 82, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.5632999818772078, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336849, \"i\": 16}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:07:29Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336849, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:07:29Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:06:54.348Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 82, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336849, \"i\": 16}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748..."}  108
2025-05-27 17:06:54 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:06:54 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:06:54 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:06:54 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 109, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.7839000027161092, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336849, \"i\": 16}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:07:29Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336849, \"i\": 16}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:07:29Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:30.251Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 109, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336849, \"i\": 16}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": ..."}  108
2025-05-27 17:06:54 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "previousDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>"}  108
2025-05-27 17:06:54 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:06:54 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "previousDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>", "newDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0007839000027161092>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>"}  108
2025-05-27 17:06:54 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0007839000027161092>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:06:54 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:06:54 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 82, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:06:54 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 109, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:06:54 DEBUG {"message": "Connection created", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:07:04 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 109, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.922799994238, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336860, \"i\": 2}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:07:40Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336860, \"i\": 2}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:07:40Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:40.254Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 109, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336860, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"..."}  108
2025-05-27 17:07:04 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 109, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:04 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 82, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.180199993541, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336860, \"i\": 2}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:07:40Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336859, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:07:39Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:04.353Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 82, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336860, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336860, \"i\": 2}}}"}  108
2025-05-27 17:07:04 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 82, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 109, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.471100018127, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:07:49Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:07:49Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:50.254Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 109, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 109, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 82, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10000.065000000177, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:07:49Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:07:49Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:14.354Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 82, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}..."}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 82, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 60, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.7536000048276037, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336868, \"i\": 14}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:07:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336868, \"i\": 14}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:07:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:06:23.207Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 60, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:07:14 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "previousDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0007839000027161092>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>", "newDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007536000048276037>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0007839000027161092>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>"}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "driverConnectionId": 1, "serverConnectionId": 60, "serverHost": "ems-02", "serverPort": 27018, "awaited": true}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection ready", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0006262999959290028}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.00570979999611}  108
2025-05-27 17:07:14 DEBUG {"message": "Command started", "clientId": {"$oid": "683580972dc57aec88079d41"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"UP5qacucRWG523BzfmQMGw==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 18467, "operationId": 18467, "driverConnectionId": 1, "serverConnectionId": 111, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683580972dc57aec88079d41"}, "durationMS": 0.723, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 18467, "operationId": 18467, "driverConnectionId": 1, "serverConnectionId": 111, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:07:14 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007536000048276037>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0007839000027161092>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>", "clientId": {"$oid": "683580972dc57aec88079d41"}}  108
2025-05-27 17:07:14 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007536000048276037>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0007839000027161092>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.999999797903001e-05}  108
2025-05-27 17:07:14 DEBUG {"message": "Command started", "clientId": {"$oid": "683580972dc57aec88079d41"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"UP5qacucRWG523BzfmQMGw==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 6334, "operationId": 6334, "driverConnectionId": 1, "serverConnectionId": 111, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683580972dc57aec88079d41"}, "durationMS": 0.5720000000000001, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336869, \"i\": 12}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 6334, "operationId": 6334, "driverConnectionId": 1, "serverConnectionId": 111, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:07:14 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection closed", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:14 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:07:14 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:07:14 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "previousDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007536000048276037>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0007839000027161092>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005632999818772078>]>", "newDescription": "<TopologyDescription id: 683580972dc57aec88079d41, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:07:14 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "683580972dc57aec88079d41"}}  108
2025-05-27 17:07:14 INFO MongoDB连接已关闭  87
2025-05-27 17:07:14 INFO MongoDB 数据: None  76
2025-05-27 17:07:14 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:07:14 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:07:14 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 500.544299982721, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 500.03739999374375, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:07:14 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683580972dc57aec88079d41"}, "serverHost": "ems-02", "serverPort": 27018, "awaited": true, "durationMS": 500.43299997923896, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:07:15 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKuYRTxhLX4 HTTP/1.1" 200 109  544
2025-05-27 17:07:15 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:07:15 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data0]  18
2025-05-27 17:07:15 INFO 测试结果：failed  19
2025-05-27 17:07:15 INFO 故障表示：test_data = {'Expected_result': '78.800', 'Mysql/Mongo': 'SOC', 'Title': '集群-SOC', 'address': '34', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:07:15 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:07:15 INFO 用例耗时：43.538685799983796  22
2025-05-27 17:07:15 INFO **************************************  23
2025-05-27 17:07:15 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 59345)  195
2025-05-27 17:07:15 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x20 0x1 0xbc  91
2025-05-27 17:07:15 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=32, count=0, bits=[], registers=[444], status=1)   113
2025-05-27 17:07:15 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:07:15 INFO Modbus 数据: None  67
2025-05-27 17:07:15 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "683580c32dc57aec88079d42"}}  108
2025-05-27 17:07:15 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "previousDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:07:15 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:15 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:15 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:15 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:15 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683580c32dc57aec88079d42"}}  108
2025-05-27 17:07:15 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "remainingTimeMS": 29999}  108
2025-05-27 17:07:37 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:07:37 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:07:37 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 112, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.8373000018764287, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336893, \"i\": 27}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:13Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336893, \"i\": 27}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:13Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:08:13.972Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 112, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336893, \"i\": 27}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": ..."}  108
2025-05-27 17:07:37 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:37 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 84, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 1.288700004806742, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336893, \"i\": 27}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:13Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336893, \"i\": 21}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:13Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:38.070Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 84, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336893, \"i\": 27}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748..."}  108
2025-05-27 17:07:37 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:07:37 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "previousDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:07:37 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:37 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "previousDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.001288700004806742>]>"}  108
2025-05-27 17:07:37 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 112, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:37 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.001288700004806742>]>", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:37 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 84, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:37 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:37 DEBUG {"message": "Connection created", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:07:47 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 112, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 10001.30510001327, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336903, \"i\": 25}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:23Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336903, \"i\": 25}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:23Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:08:23.977Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 112, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336903, \"i\": 25}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:07:47 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 112, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:47 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 84, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.651500002481, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336903, \"i\": 25}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:23Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336903, \"i\": 21}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:23Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:48.075Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 84, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336903, \"i\": 25}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336903, \"i\": 25}}..."}  108
2025-05-27 17:07:47 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 84, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:57 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 112, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.418299994431, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:33Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 16}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:33Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:08:33.977Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 112, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:07:57 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 112, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:57 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 84, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 9999.839600000996, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:33Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 16}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:33Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:58.076Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 84, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}..."}  108
2025-05-27 17:07:57 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 84, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:07:57 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:07:57 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 62, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.6707999855279922, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336912, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:32Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336912, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:32Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:06.935Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 62, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:07:57 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "previousDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.001288700004806742>]>", "newDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0006707999855279922>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.001288700004806742>]>"}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection ready", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0012573999993037432}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.011079999996582}  108
2025-05-27 17:07:57 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "driverConnectionId": 1, "serverConnectionId": 62, "serverHost": "ems-02", "serverPort": 27018, "awaited": true}  108
2025-05-27 17:07:57 DEBUG {"message": "Command started", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"3Ak/giZsTkq+bQDbsABnsA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 19169, "operationId": 19169, "driverConnectionId": 1, "serverConnectionId": 114, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "durationMS": 0.8059999999999999, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 19169, "operationId": 19169, "driverConnectionId": 1, "serverConnectionId": 114, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:07:57 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0006707999855279922>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.001288700004806742>]>", "clientId": {"$oid": "683580c32dc57aec88079d42"}}  108
2025-05-27 17:07:57 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0006707999855279922>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.001288700004806742>]>", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0010479000047780573}  108
2025-05-27 17:07:57 DEBUG {"message": "Command started", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"3Ak/giZsTkq+bQDbsABnsA==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 15724, "operationId": 15724, "driverConnectionId": 1, "serverConnectionId": 114, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "durationMS": 0.5289999999999999, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336913, \"i\": 18}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 15724, "operationId": 15724, "driverConnectionId": 1, "serverConnectionId": 114, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:07:57 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection closed", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:57 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:07:57 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580c32dc57aec88079d42"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:07:57 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580c32dc57aec88079d42"}, "previousDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0006707999855279922>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008373000018764287>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.001288700004806742>]>", "newDescription": "<TopologyDescription id: 683580c32dc57aec88079d42, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:07:57 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "683580c32dc57aec88079d42"}}  108
2025-05-27 17:07:57 INFO MongoDB连接已关闭  87
2025-05-27 17:07:57 INFO MongoDB 数据: None  76
2025-05-27 17:07:57 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:07:58 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:07:58 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:07:59 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recYi7EnJ4 HTTP/1.1" 200 101  544
2025-05-27 17:07:59 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:07:59 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data1]  18
2025-05-27 17:07:59 INFO 测试结果：failed  19
2025-05-27 17:07:59 INFO 故障表示：test_data = {'Expected_result': '44.400', 'Mysql/Mongo': 'BV', 'Title': '集群-系统电压', 'address': '32', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:07:59 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:07:59 INFO 用例耗时：43.63318049997906  22
2025-05-27 17:07:59 INFO **************************************  23
2025-05-27 17:07:59 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 60070)  195
2025-05-27 17:07:59 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x21 0x50 0xb0  91
2025-05-27 17:07:59 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=33, count=0, bits=[], registers=[20656], status=1)   113
2025-05-27 17:07:59 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:07:59 INFO Modbus 数据: None  67
2025-05-27 17:07:59 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}}  108
2025-05-27 17:07:59 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "previousDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:07:59 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:59 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:59 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:07:59 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:07:59 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683580ef2dc57aec88079d43"}}  108
2025-05-27 17:07:59 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "remainingTimeMS": 29999}  108
2025-05-27 17:08:19 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:08:19 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 115, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.5014000053051859, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336935, \"i\": 4}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:55Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336935, \"i\": 4}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:55Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:08:55.377Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 115, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336935, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00..."}  108
2025-05-27 17:08:19 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:19 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:08:19 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "previousDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:08:19 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:19 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:19 DEBUG {"message": "Connection created", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:08:19 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 115, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:08:21 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:08:21 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 86, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.598300015553832, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336937, \"i\": 13}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:08:57Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336937, \"i\": 11}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:08:57Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:08:21.715Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 86, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336937, \"i\": 13}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748..."}  108
2025-05-27 17:08:21 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:08:21 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "previousDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.000598300015553832>]>"}  108
2025-05-27 17:08:21 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 86, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:08:29 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 115, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.59459999809, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336945, \"i\": 17}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:05Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336945, \"i\": 13}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:05Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:05.379Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 115, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336945, \"i\": 17}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:08:29 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 115, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:08:31 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 86, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10000.616500008618, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336947, \"i\": 18}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:07Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336947, \"i\": 8}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:07Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:08:31.717Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 86, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336947, \"i\": 18}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336947, \"i\": 18}}}"}  108
2025-05-27 17:08:31 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 86, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:08:39 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 115, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.419800005853, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:15Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:15Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:15.380Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 115, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:08:39 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 115, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:08:39 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:08:39 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 64, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.7128000142984092, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336954, \"i\": 6}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:14Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336954, \"i\": 6}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:14Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:07:48.334Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 64, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:08:39 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "previousDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.000598300015553832>]>", "newDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007128000142984092>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.000598300015553832>]>"}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection ready", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0013615000061690807}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.00701339999796}  108
2025-05-27 17:08:39 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "driverConnectionId": 1, "serverConnectionId": 64, "serverHost": "ems-02", "serverPort": 27018, "awaited": true}  108
2025-05-27 17:08:39 DEBUG {"message": "Command started", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"VxRiM70lS3SjhozcgR4BYA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 29358, "operationId": 29358, "driverConnectionId": 1, "serverConnectionId": 117, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "durationMS": 0.859, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 29358, "operationId": 29358, "driverConnectionId": 1, "serverConnectionId": 117, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:08:39 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007128000142984092>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.000598300015553832>]>", "clientId": {"$oid": "683580ef2dc57aec88079d43"}}  108
2025-05-27 17:08:39 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007128000142984092>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.000598300015553832>]>", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 4.8299989430233836e-05}  108
2025-05-27 17:08:39 DEBUG {"message": "Command started", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"VxRiM70lS3SjhozcgR4BYA==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 26962, "operationId": 26962, "driverConnectionId": 1, "serverConnectionId": 117, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "durationMS": 0.41100000000000003, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336955, \"i\": 10}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 26962, "operationId": 26962, "driverConnectionId": 1, "serverConnectionId": 117, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:08:39 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection closed", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:39 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:08:39 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:08:39 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "previousDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007128000142984092>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005014000053051859>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.000598300015553832>]>", "newDescription": "<TopologyDescription id: 683580ef2dc57aec88079d43, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:08:39 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}}  108
2025-05-27 17:08:39 INFO MongoDB连接已关闭  87
2025-05-27 17:08:39 INFO MongoDB 数据: None  76
2025-05-27 17:08:39 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:08:39 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:08:39 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:08:39 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 8004.061099985847, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:08:39 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 500.66879999940284, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:08:39 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683580ef2dc57aec88079d43"}, "serverHost": "ems-02", "serverPort": 27018, "awaited": true, "durationMS": 501.30460000946186, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:08:40 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuJCUc8lY1Lr HTTP/1.1" 200 109  544
2025-05-27 17:08:40 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:08:40 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data2]  18
2025-05-27 17:08:40 INFO 测试结果：failed  19
2025-05-27 17:08:40 INFO 故障表示：test_data = {'Expected_result': '656.000', 'Mysql/Mongo': 'Bcc', 'Title': '集群-系统电流', 'address': '33', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:08:40 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:08:40 INFO 用例耗时：41.29901560000144  22
2025-05-27 17:08:40 INFO **************************************  23
2025-05-27 17:08:40 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 60742)  195
2025-05-27 17:08:40 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x23 0x3 0xdb  91
2025-05-27 17:08:40 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=35, count=0, bits=[], registers=[987], status=1)   113
2025-05-27 17:08:40 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:08:40 INFO Modbus 数据: None  67
2025-05-27 17:08:40 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "683581182dc57aec88079d44"}}  108
2025-05-27 17:08:40 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "previousDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:08:40 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:08:40 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:40 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:08:40 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:08:40 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581182dc57aec88079d44"}}  108
2025-05-27 17:08:40 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581182dc57aec88079d44"}, "remainingTimeMS": 29999}  108
2025-05-27 17:09:02 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:09:02 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:09:02 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 118, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.5233999982010573, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336978, \"i\": 22}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336978, \"i\": 22}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:38.925Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 118, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336978, \"i\": 22}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": ..."}  108
2025-05-27 17:09:02 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:02 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 88, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 1.0467999964021146, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336978, \"i\": 22}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336978, \"i\": 16}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:03.023Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 88, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336978, \"i\": 22}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748..."}  108
2025-05-27 17:09:02 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:09:02 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "previousDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:09:02 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:02 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:09:02 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "previousDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0010467999964021146>]>"}  108
2025-05-27 17:09:02 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 118, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:02 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:02 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 88, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:02 DEBUG {"message": "Connection created", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:09:12 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 118, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 10000.875800003996, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336988, \"i\": 22}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336988, \"i\": 20}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:48.929Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 118, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336988, \"i\": 22}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:09:12 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 118, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:12 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 88, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.246600004379, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336988, \"i\": 22}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336988, \"i\": 20}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:13.028Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 88, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336988, \"i\": 22}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336988, \"i\": 22}}..."}  108
2025-05-27 17:09:12 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 88, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:22 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 118, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9998.489999998128, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:58.929Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 118, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:09:22 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 118, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:22 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 88, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 9999.748300004285, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 8}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:23.029Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 88, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}}"}  108
2025-05-27 17:09:22 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 88, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:22 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:09:22 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 66, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.6020000146236271, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:09:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:09:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:08:31.881Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 66, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:09:22 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "previousDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0010467999964021146>]>", "newDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0006020000146236271>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0010467999964021146>]>"}  108
2025-05-27 17:09:22 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "driverConnectionId": 1, "serverConnectionId": 66, "serverHost": "ems-02", "serverPort": 27018, "awaited": true}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection ready", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0005653999978676438}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.005924299999606}  108
2025-05-27 17:09:22 DEBUG {"message": "Command started", "clientId": {"$oid": "683581182dc57aec88079d44"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"Ma1YiDqmR8ydFUrKEHj/hQ==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 5705, "operationId": 5705, "driverConnectionId": 1, "serverConnectionId": 120, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683581182dc57aec88079d44"}, "durationMS": 0.597, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 5705, "operationId": 5705, "driverConnectionId": 1, "serverConnectionId": 120, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:09:22 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0006020000146236271>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0010467999964021146>]>", "clientId": {"$oid": "683581182dc57aec88079d44"}}  108
2025-05-27 17:09:22 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0006020000146236271>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0010467999964021146>]>", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.569999434053898e-05}  108
2025-05-27 17:09:22 DEBUG {"message": "Command started", "clientId": {"$oid": "683581182dc57aec88079d44"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"Ma1YiDqmR8ydFUrKEHj/hQ==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 28145, "operationId": 28145, "driverConnectionId": 1, "serverConnectionId": 120, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683581182dc57aec88079d44"}, "durationMS": 0.417, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748336998, \"i\": 10}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 28145, "operationId": 28145, "driverConnectionId": 1, "serverConnectionId": 120, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:09:22 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection closed", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:22 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:09:22 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581182dc57aec88079d44"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:09:22 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581182dc57aec88079d44"}, "previousDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0006020000146236271>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005233999982010573>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0010467999964021146>]>", "newDescription": "<TopologyDescription id: 683581182dc57aec88079d44, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:09:22 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "683581182dc57aec88079d44"}}  108
2025-05-27 17:09:22 INFO MongoDB连接已关闭  87
2025-05-27 17:09:22 INFO MongoDB 数据: None  76
2025-05-27 17:09:22 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:09:23 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:09:23 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:09:24 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKyYblOePGE HTTP/1.1" 200 109  544
2025-05-27 17:09:24 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:09:24 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data3]  18
2025-05-27 17:09:24 INFO 测试结果：failed  19
2025-05-27 17:09:24 INFO 故障表示：test_data = {'Expected_result': '98.700', 'Mysql/Mongo': 'SOH', 'Title': '集群-SOH', 'address': '35', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:09:24 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:09:24 INFO 用例耗时：43.512309700017795  22
2025-05-27 17:09:24 INFO **************************************  23
2025-05-27 17:09:24 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 61459)  195
2025-05-27 17:09:24 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x24 0x0 0x1d  91
2025-05-27 17:09:24 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=36, count=0, bits=[], registers=[29], status=1)   113
2025-05-27 17:09:24 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:09:24 INFO Modbus 数据: None  67
2025-05-27 17:09:24 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "683581442dc57aec88079d45"}}  108
2025-05-27 17:09:24 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "previousDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:09:24 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:09:24 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:24 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:09:24 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:24 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581442dc57aec88079d45"}}  108
2025-05-27 17:09:24 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581442dc57aec88079d45"}, "remainingTimeMS": 29999}  108
2025-05-27 17:09:46 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:09:46 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 90, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.5955999949947, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337022, \"i\": 6}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:10:22Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337022, \"i\": 4}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:10:22Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:46.547Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 90, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337022, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337..."}  108
2025-05-27 17:09:46 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:09:46 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:09:46 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 121, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.4861000052187592, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337022, \"i\": 6}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:10:22Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337022, \"i\": 6}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:10:22Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:10:22.450Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 121, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337022, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00..."}  108
2025-05-27 17:09:46 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:09:46 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "previousDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005955999949947>]>"}  108
2025-05-27 17:09:46 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:46 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "previousDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005955999949947>]>", "newDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0004861000052187592>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005955999949947>]>"}  108
2025-05-27 17:09:46 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 90, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:46 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0004861000052187592>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005955999949947>]>", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:46 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:09:46 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 121, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:46 DEBUG {"message": "Connection created", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:09:56 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 121, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 10000.071200018283, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337032, \"i\": 6}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:10:32Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337032, \"i\": 6}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:10:32Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:10:32.453Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 121, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337032, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"..."}  108
2025-05-27 17:09:56 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 121, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:09:56 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 90, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.377500011586, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337032, \"i\": 6}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:10:32Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337032, \"i\": 2}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:10:32Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:56.552Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 90, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337032, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337032, \"i\": 6}}}"}  108
2025-05-27 17:09:56 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 90, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:06 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 121, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.406499991892, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:10:42Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:10:42Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:10:42.453Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 121, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"..."}  108
2025-05-27 17:10:06 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 121, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:06 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 90, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10000.037200021325, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:10:42Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337041, \"i\": 18}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:10:41Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:10:06.553Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 90, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}}"}  108
2025-05-27 17:10:06 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 90, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection ready", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0007735000108368695}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.004801100003533}  108
2025-05-27 17:10:06 DEBUG {"message": "Command started", "clientId": {"$oid": "683581442dc57aec88079d45"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"ZZ5e5FF7SduLEunXgTA8Bg==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 16827, "operationId": 16827, "driverConnectionId": 1, "serverConnectionId": 123, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683581442dc57aec88079d45"}, "durationMS": 0.674, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 16827, "operationId": 16827, "driverConnectionId": 1, "serverConnectionId": 123, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:10:06 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0004861000052187592>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005955999949947>]>", "clientId": {"$oid": "683581442dc57aec88079d45"}}  108
2025-05-27 17:10:06 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0004861000052187592>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005955999949947>]>", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.159999222494662e-05}  108
2025-05-27 17:10:06 DEBUG {"message": "Command started", "clientId": {"$oid": "683581442dc57aec88079d45"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"ZZ5e5FF7SduLEunXgTA8Bg==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 9961, "operationId": 9961, "driverConnectionId": 1, "serverConnectionId": 123, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683581442dc57aec88079d45"}, "durationMS": 0.546, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 2}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 9961, "operationId": 9961, "driverConnectionId": 1, "serverConnectionId": 123, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:10:06 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection closed", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:06 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:10:06 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:10:06 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "previousDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0004861000052187592>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005955999949947>]>", "newDescription": "<TopologyDescription id: 683581442dc57aec88079d45, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:10:06 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "683581442dc57aec88079d45"}}  108
2025-05-27 17:10:06 INFO MongoDB连接已关闭  87
2025-05-27 17:10:06 INFO MongoDB 数据: None  76
2025-05-27 17:10:06 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:10:06 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:10:06 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:10:06 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 500.08500000694767, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:10:06 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 499.9662000045646, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:10:07 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKzcdXodiKE HTTP/1.1" 200 109  544
2025-05-27 17:10:07 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:10:07 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data4]  18
2025-05-27 17:10:07 INFO 测试结果：failed  19
2025-05-27 17:10:07 INFO 故障表示：test_data = {'Expected_result': '0.029', 'Mysql/Mongo': 'BVMax', 'Title': '集群-单体最高电压值', 'address': '36', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:10:07 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:10:07 INFO 用例耗时：43.71542579997913  22
2025-05-27 17:10:07 INFO **************************************  23
2025-05-27 17:10:07 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 62178)  195
2025-05-27 17:10:07 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x25 0x0 0x43  91
2025-05-27 17:10:07 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=37, count=0, bits=[], registers=[67], status=1)   113
2025-05-27 17:10:07 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:10:07 INFO Modbus 数据: None  67
2025-05-27 17:10:07 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}}  108
2025-05-27 17:10:07 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "previousDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:10:07 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:07 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:07 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:07 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:07 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6835816f2dc57aec88079d46"}}  108
2025-05-27 17:10:07 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "remainingTimeMS": 29999}  108
2025-05-27 17:10:08 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:10:08 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581442dc57aec88079d45"}, "driverConnectionId": 1, "serverConnectionId": 68, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.5985999887343496, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:10:42Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337042, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:10:42Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:17.664Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 68, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:10:30 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:10:30 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 92, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.5506000015884638, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337065, \"i\": 23}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:05Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337065, \"i\": 17}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:05Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:10:30.273Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 92, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337065, \"i\": 23}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748..."}  108
2025-05-27 17:10:30 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:10:30 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:30 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 124, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.5170999793335795, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337065, \"i\": 23}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:05Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337065, \"i\": 23}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:05Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:06.175Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 124, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337065, \"i\": 23}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": ..."}  108
2025-05-27 17:10:30 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:10:30 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "previousDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>"}  108
2025-05-27 17:10:30 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:30 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "previousDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>", "newDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005170999793335795>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>"}  108
2025-05-27 17:10:30 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005170999793335795>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:30 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:30 DEBUG {"message": "Connection created", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:10:30 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 124, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:30 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 92, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:40 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 124, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 10000.464699987788, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337076, \"i\": 2}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337076, \"i\": 2}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:16Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:16.178Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 124, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337076, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"..."}  108
2025-05-27 17:10:40 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 92, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10000.779199996032, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337076, \"i\": 2}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337075, \"i\": 22}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:15Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:10:40.277Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 92, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337076, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337076, \"i\": 2}}}"}  108
2025-05-27 17:10:40 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 124, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:40 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 92, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:50 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 124, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9998.05270001525, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337085, \"i\": 20}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:25Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:26.178Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 124, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, ..."}  108
2025-05-27 17:10:50 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 124, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:50 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 92, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 9999.385100003565, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337085, \"i\": 20}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:25Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:10:50.278Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 92, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}}"}  108
2025-05-27 17:10:50 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 92, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:10:50 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:10:50 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 70, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.7905999955255538, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337084, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:24Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337084, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:24Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:09:59.130Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 70, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:10:50 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "previousDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005170999793335795>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>", "newDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007905999955255538>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005170999793335795>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>"}  108
2025-05-27 17:10:50 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "driverConnectionId": 1, "serverConnectionId": 70, "serverHost": "ems-02", "serverPort": 27018, "awaited": true}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.000607599999057129}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.005696999985958}  108
2025-05-27 17:10:50 DEBUG {"message": "Command started", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"8UZWIPt9S9+NxRa14V4SGg==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 2995, "operationId": 2995, "driverConnectionId": 1, "serverConnectionId": 126, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "durationMS": 0.828, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 2995, "operationId": 2995, "driverConnectionId": 1, "serverConnectionId": 126, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:10:50 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007905999955255538>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005170999793335795>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>", "clientId": {"$oid": "6835816f2dc57aec88079d46"}}  108
2025-05-27 17:10:50 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007905999955255538>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005170999793335795>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.699999307282269e-05}  108
2025-05-27 17:10:50 DEBUG {"message": "Command started", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"8UZWIPt9S9+NxRa14V4SGg==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 11942, "operationId": 11942, "driverConnectionId": 1, "serverConnectionId": 126, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "durationMS": 0.474, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337086, \"i\": 4}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 11942, "operationId": 11942, "driverConnectionId": 1, "serverConnectionId": 126, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:10:50 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:50 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:10:50 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835816f2dc57aec88079d46"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:10:50 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}, "previousDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007905999955255538>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005170999793335795>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005506000015884638>]>", "newDescription": "<TopologyDescription id: 6835816f2dc57aec88079d46, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:10:50 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6835816f2dc57aec88079d46"}}  108
2025-05-27 17:10:50 INFO MongoDB连接已关闭  87
2025-05-27 17:10:50 INFO MongoDB 数据: None  76
2025-05-27 17:10:50 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:10:50 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:10:50 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:10:51 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKzcf9CJGF9 HTTP/1.1" 200 109  544
2025-05-27 17:10:51 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:10:51 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data5]  18
2025-05-27 17:10:51 INFO 测试结果：failed  19
2025-05-27 17:10:51 INFO 故障表示：test_data = {'Expected_result': '0.067', 'Mysql/Mongo': 'BVMin', 'Title': '集群-单体最低电压值', 'address': '37', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:10:51 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:10:51 INFO 用例耗时：43.605540999997174  22
2025-05-27 17:10:51 INFO **************************************  23
2025-05-27 17:10:51 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 62897)  195
2025-05-27 17:10:51 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x26 0x2 0xdb  91
2025-05-27 17:10:51 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=38, count=0, bits=[], registers=[731], status=1)   113
2025-05-27 17:10:51 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:10:51 INFO Modbus 数据: None  67
2025-05-27 17:10:51 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}}  108
2025-05-27 17:10:51 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "previousDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:10:51 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:51 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:51 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:10:51 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:10:51 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6835819b2dc57aec88079d47"}}  108
2025-05-27 17:10:51 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "remainingTimeMS": 29999}  108
2025-05-27 17:11:11 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:11:11 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 127, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.5913999921176583, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337107, \"i\": 6}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:47Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337107, \"i\": 6}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:47Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:47.539Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 127, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337107, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00..."}  108
2025-05-27 17:11:11 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:11 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:11:11 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "previousDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005913999921176583>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:11:11 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005913999921176583>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:11 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:11 DEBUG {"message": "Connection created", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:11:11 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 127, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:11:13 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:11:13 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 94, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.4724999889731407, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337109, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:49Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337109, \"i\": 6}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:49Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:13.888Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 94, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337109, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 17483..."}  108
2025-05-27 17:11:13 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:11:13 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "previousDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005913999921176583>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005913999921176583>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0004724999889731407>]>"}  108
2025-05-27 17:11:13 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 94, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:11:21 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 127, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.82430000091, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337117, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:57Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337117, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:57Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:57.541Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 127, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337117, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:11:21 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 127, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:11:23 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 94, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10000.755699991714, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337119, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:11:59Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337119, \"i\": 4}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:11:59Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:23.890Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 94, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337119, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337119, \"i\": 10}}}"}  108
2025-05-27 17:11:23 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 94, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:11:31 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 127, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.41590000526, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 8}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:07Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 6}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:07Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:07.541Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 127, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"..."}  108
2025-05-27 17:11:31 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 127, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0009468999924138188}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.0048532000219}  108
2025-05-27 17:11:31 DEBUG {"message": "Command started", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"JXOhuleGQ+ebBknrTruy4Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 5436, "operationId": 5436, "driverConnectionId": 1, "serverConnectionId": 129, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "durationMS": 0.747, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 8}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 5436, "operationId": 5436, "driverConnectionId": 1, "serverConnectionId": 129, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:11:31 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005913999921176583>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0004724999889731407>]>", "clientId": {"$oid": "6835819b2dc57aec88079d47"}}  108
2025-05-27 17:11:31 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005913999921176583>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0004724999889731407>]>", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.139999070204794e-05}  108
2025-05-27 17:11:31 DEBUG {"message": "Command started", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"JXOhuleGQ+ebBknrTruy4Q==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 32391, "operationId": 32391, "driverConnectionId": 1, "serverConnectionId": 129, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "durationMS": 0.55, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337127, \"i\": 8}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 32391, "operationId": 32391, "driverConnectionId": 1, "serverConnectionId": 129, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:11:31 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:31 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:11:31 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:11:31 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "previousDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005913999921176583>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0004724999889731407>]>", "newDescription": "<TopologyDescription id: 6835819b2dc57aec88079d47, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:11:31 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}}  108
2025-05-27 17:11:31 INFO MongoDB连接已关闭  87
2025-05-27 17:11:31 INFO MongoDB 数据: None  76
2025-05-27 17:11:31 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:11:31 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:11:31 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "driverConnectionId": 1, "serverConnectionId": 72, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.5299999902490526, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337126, \"i\": 8}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:06Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337126, \"i\": 8}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:06Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:10:40.505Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 72, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:11:31 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:11:31 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:11:31 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 8008.712299983017, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:11:31 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "6835819b2dc57aec88079d47"}, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 499.64169997838326, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:11:32 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKze9P9k8pG HTTP/1.1" 200 109  544
2025-05-27 17:11:32 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:11:32 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data6]  18
2025-05-27 17:11:32 INFO 测试结果：failed  19
2025-05-27 17:11:32 INFO 故障表示：test_data = {'Expected_result': '0.731', 'Mysql/Mongo': 'BVAvg', 'Title': '集群-单体平均电压值', 'address': '38', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:11:32 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:11:32 INFO 用例耗时：41.295236400008434  22
2025-05-27 17:11:32 INFO **************************************  23
2025-05-27 17:11:32 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 63578)  195
2025-05-27 17:11:32 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x27 0x0 0x4d  91
2025-05-27 17:11:32 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=39, count=0, bits=[], registers=[77], status=1)   113
2025-05-27 17:11:32 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:11:32 INFO Modbus 数据: None  67
2025-05-27 17:11:32 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "683581c42dc57aec88079d48"}}  108
2025-05-27 17:11:32 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "previousDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:11:32 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:11:32 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:32 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:11:32 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:32 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581c42dc57aec88079d48"}}  108
2025-05-27 17:11:32 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "remainingTimeMS": 29999}  108
2025-05-27 17:11:55 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:11:55 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 96, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.5487999878823757, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337150, \"i\": 19}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:30Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337150, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:30Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:55.192Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 96, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337150, \"i\": 19}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748..."}  108
2025-05-27 17:11:55 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:11:55 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:11:55 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:11:55 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "previousDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>"}  108
2025-05-27 17:11:55 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 96, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:11:55 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 130, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.8136999967973679, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337150, \"i\": 19}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:30Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337150, \"i\": 19}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:30Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:31.096Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 130, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337150, \"i\": 19}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": ..."}  108
2025-05-27 17:11:55 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:55 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "previousDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>", "newDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008136999967973679>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>"}  108
2025-05-27 17:11:55 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008136999967973679>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:55 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 130, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:11:55 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:11:55 DEBUG {"message": "Connection created", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:12:05 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 96, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10000.687799998559, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337160, \"i\": 16}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:40Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337160, \"i\": 14}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:40Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:05.196Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 96, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337160, \"i\": 16}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337160, \"i\": 16}}..."}  108
2025-05-27 17:12:05 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 96, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:12:05 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 130, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 10000.424300000304, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337160, \"i\": 16}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:40Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337160, \"i\": 16}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:40Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:41.098Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 130, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337160, \"i\": 16}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:12:05 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 130, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:12:15 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 130, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9998.704199999338, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:50Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:50Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:51.098Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 130, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:12:15 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 130, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:12:15 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 96, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10000.340300000971, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:50Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 6}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:50Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:15.197Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 96, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 12}}}"}  108
2025-05-27 17:12:15 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 96, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:12:15 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:12:15 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 74, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.774399988586083, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:12:50Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337170, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:12:50Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:11:24.049Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 74, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:12:15 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "previousDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008136999967973679>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>", "newDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007743999885860831>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008136999967973679>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>"}  108
2025-05-27 17:12:15 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "driverConnectionId": 1, "serverConnectionId": 74, "serverHost": "ems-02", "serverPort": 27018, "awaited": true}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection ready", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0007972999883349985}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 22.255968500016024}  108
2025-05-27 17:12:17 DEBUG {"message": "Command started", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"hebfdcXTRxGsDcMEODFhwg==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337173, \"i\": 13}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 3902, "operationId": 3902, "driverConnectionId": 1, "serverConnectionId": 132, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "durationMS": 0.703, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337173, \"i\": 13}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337173, \"i\": 13}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 3902, "operationId": 3902, "driverConnectionId": 1, "serverConnectionId": 132, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:12:17 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007743999885860831>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008136999967973679>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>", "clientId": {"$oid": "683581c42dc57aec88079d48"}}  108
2025-05-27 17:12:17 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007743999885860831>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008136999967973679>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.43999844416976e-05}  108
2025-05-27 17:12:17 DEBUG {"message": "Command started", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"hebfdcXTRxGsDcMEODFhwg==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337173, \"i\": 13}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 153, "operationId": 153, "driverConnectionId": 1, "serverConnectionId": 132, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "durationMS": 0.597, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337173, \"i\": 13}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337173, \"i\": 13}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 153, "operationId": 153, "driverConnectionId": 1, "serverConnectionId": 132, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:12:17 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection closed", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:17 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:12:17 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581c42dc57aec88079d48"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:12:17 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581c42dc57aec88079d48"}, "previousDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0007743999885860831>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0008136999967973679>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0005487999878823757>]>", "newDescription": "<TopologyDescription id: 683581c42dc57aec88079d48, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:12:17 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "683581c42dc57aec88079d48"}}  108
2025-05-27 17:12:17 INFO MongoDB连接已关闭  87
2025-05-27 17:12:17 INFO MongoDB 数据: None  76
2025-05-27 17:12:17 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:12:17 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:12:17 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:12:18 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKze9ZWG6ot HTTP/1.1" 200 109  544
2025-05-27 17:12:18 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:12:18 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data7]  18
2025-05-27 17:12:18 INFO 测试结果：failed  19
2025-05-27 17:12:18 INFO 故障表示：test_data = {'Expected_result': '27.000', 'Mysql/Mongo': 'BTMax', 'Title': '集群-单体最高温度值', 'address': '39', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:12:18 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:12:18 INFO 用例耗时：45.74289380002301  22
2025-05-27 17:12:18 INFO **************************************  23
2025-05-27 17:12:18 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 64326)  195
2025-05-27 17:12:18 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x28 0x0 0x5b  91
2025-05-27 17:12:18 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=40, count=0, bits=[], registers=[91], status=1)   113
2025-05-27 17:12:18 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:12:18 INFO Modbus 数据: None  67
2025-05-27 17:12:18 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "683581f22dc57aec88079d49"}}  108
2025-05-27 17:12:18 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "previousDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:12:18 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:12:18 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:18 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:12:18 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:18 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581f22dc57aec88079d49"}}  108
2025-05-27 17:12:18 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "remainingTimeMS": 29999}  108
2025-05-27 17:12:38 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:12:38 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 133, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.6211000145412982, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337194, \"i\": 16}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:13:14Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337194, \"i\": 16}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:13:14Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:13:14.599Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 133, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337194, \"i\": 17}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": ..."}  108
2025-05-27 17:12:38 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:38 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:12:38 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "previousDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:12:38 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:38 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:12:38 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 133, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:12:38 DEBUG {"message": "Connection created", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:12:40 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:12:40 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 98, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.44159998651593924, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337196, \"i\": 22}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:13:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337196, \"i\": 18}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:13:16Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:40.958Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 98, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337196, \"i\": 22}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748..."}  108
2025-05-27 17:12:40 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:12:40 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "previousDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.00044159998651593924>]>"}  108
2025-05-27 17:12:40 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 98, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:12:53 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 133, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.65610000072, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337204, \"i\": 19}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:13:24Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337204, \"i\": 19}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:13:24Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:13:24.602Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 133, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337204, \"i\": 19}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:12:53 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 133, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:12:56 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 98, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.141899992945, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337206, \"i\": 22}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:13:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337206, \"i\": 20}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:13:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:50.961Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 98, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337206, \"i\": 22}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337206, \"i\": 22}}..."}  108
2025-05-27 17:12:56 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 98, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:13:03 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 133, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.485300009837, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337214, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:13:34Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337214, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:13:34Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:13:34.602Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 133, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337214, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:13:03 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 133, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:13:03 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:13:03 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 76, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.8158999844454229, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337212, \"i\": 20}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:13:32Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337212, \"i\": 20}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:13:32Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:07.555Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 76, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:13:03 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "previousDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.00044159998651593924>]>", "newDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0008158999844454229>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.00044159998651593924>]>"}  108
2025-05-27 17:13:03 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 76, "serverHost": "ems-02", "serverPort": 27018, "awaited": true}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection ready", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0007732000085525215}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 22.256790899991756}  108
2025-05-27 17:13:06 DEBUG {"message": "Command started", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"Mx6A8WrLRb68NrkVdI75fA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 20}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 12382, "operationId": 12382, "driverConnectionId": 1, "serverConnectionId": 135, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "durationMS": 0.612, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 20}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 20}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 12382, "operationId": 12382, "driverConnectionId": 1, "serverConnectionId": 135, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:13:06 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0008158999844454229>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.00044159998651593924>]>", "clientId": {"$oid": "683581f22dc57aec88079d49"}}  108
2025-05-27 17:13:06 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0008158999844454229>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.00044159998651593924>]>", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.259999983943999e-05}  108
2025-05-27 17:13:06 DEBUG {"message": "Command started", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"Mx6A8WrLRb68NrkVdI75fA==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 20}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 17421, "operationId": 17421, "driverConnectionId": 1, "serverConnectionId": 135, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "durationMS": 0.47600000000000003, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 20}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 20}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 17421, "operationId": 17421, "driverConnectionId": 1, "serverConnectionId": 135, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:13:06 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection closed", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:06 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:13:06 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:13:06 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "previousDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0008158999844454229>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006211000145412982>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.00044159998651593924>]>", "newDescription": "<TopologyDescription id: 683581f22dc57aec88079d49, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:13:06 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "683581f22dc57aec88079d49"}}  108
2025-05-27 17:13:06 INFO MongoDB连接已关闭  87
2025-05-27 17:13:06 INFO MongoDB 数据: None  76
2025-05-27 17:13:06 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:13:06 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "driverConnectionId": 1, "serverConnectionId": 98, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.058599998942, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 22}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:13:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 20}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:13:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:13:00.962Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 98, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 22}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337216, \"i\": 22}}..."}  108
2025-05-27 17:13:06 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:13:06 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:13:06 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 2500.851299992064, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:13:06 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683581f22dc57aec88079d49"}, "serverHost": "ems-02", "serverPort": 27018, "awaited": true, "durationMS": 2501.0337000130676, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:13:07 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKzeadRQ9t4 HTTP/1.1" 200 109  544
2025-05-27 17:13:07 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:13:07 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data8]  18
2025-05-27 17:13:07 INFO 测试结果：failed  19
2025-05-27 17:13:07 INFO 故障表示：test_data = {'Expected_result': '41.000', 'Mysql/Mongo': 'BTMin', 'Title': '集群-单体最低温度值', 'address': '40', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:13:07 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:13:07 INFO 用例耗时：43.50624029999017  22
2025-05-27 17:13:07 INFO **************************************  23
2025-05-27 17:13:07 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 65038)  195
2025-05-27 17:13:07 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x29 0x0 0x57  91
2025-05-27 17:13:07 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=41, count=0, bits=[], registers=[87], status=1)   113
2025-05-27 17:13:07 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:13:07 INFO Modbus 数据: None  67
2025-05-27 17:13:07 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "683582232dc57aec88079d4a"}}  108
2025-05-27 17:13:07 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "previousDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:13:07 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:07 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:07 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:07 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:07 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683582232dc57aec88079d4a"}}  108
2025-05-27 17:13:07 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "remainingTimeMS": 29999}  108
2025-05-27 17:13:29 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:13:29 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 136, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.6203999801073223, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337240, \"i\": 4}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:00Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337240, \"i\": 4}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:00Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:14:00.371Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 136, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337240, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00..."}  108
2025-05-27 17:13:29 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:29 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:13:29 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "previousDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006203999801073223>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:13:29 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006203999801073223>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:29 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:29 DEBUG {"message": "Connection created", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:13:29 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 136, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:13:29 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:13:29 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 100, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.4726000188384205, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337240, \"i\": 4}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:00Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337239, \"i\": 18}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:13:59Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:13:24.480Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 100, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337240, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 17483..."}  108
2025-05-27 17:13:29 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:29 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "previousDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006203999801073223>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006203999801073223>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0004726000188384205>]>"}  108
2025-05-27 17:13:29 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 100, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:13:39 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 136, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 10000.745500001358, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337250, \"i\": 6}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:10Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337250, \"i\": 6}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:10Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:14:10.374Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 136, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337250, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"..."}  108
2025-05-27 17:13:39 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 136, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:13:39 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 100, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.080900023226, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337250, \"i\": 6}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:10Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337250, \"i\": 2}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:10Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:13:34.482Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 100, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337250, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337250, \"i\": 6}}}"}  108
2025-05-27 17:13:39 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 100, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:13:49 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 136, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.406299990369, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:20Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 8}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:20Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:14:20.375Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 136, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}},..."}  108
2025-05-27 17:13:49 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 136, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection ready", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0008754000009503216}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.004558100015856}  108
2025-05-27 17:13:49 DEBUG {"message": "Command started", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"tVQuNNdoQFmDRs1rE5FJiw==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 19718, "operationId": 19718, "driverConnectionId": 1, "serverConnectionId": 138, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "durationMS": 0.7020000000000001, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 19718, "operationId": 19718, "driverConnectionId": 1, "serverConnectionId": 138, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:13:49 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006203999801073223>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0004726000188384205>]>", "clientId": {"$oid": "683582232dc57aec88079d4a"}}  108
2025-05-27 17:13:49 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006203999801073223>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0004726000188384205>]>", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.919997395016253e-05}  108
2025-05-27 17:13:49 DEBUG {"message": "Command started", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"tVQuNNdoQFmDRs1rE5FJiw==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 19895, "operationId": 19895, "driverConnectionId": 1, "serverConnectionId": 138, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "durationMS": 0.553, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 19895, "operationId": 19895, "driverConnectionId": 1, "serverConnectionId": 138, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:13:49 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection closed", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:49 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:13:49 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:13:49 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "previousDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0006203999801073223>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0004726000188384205>]>", "newDescription": "<TopologyDescription id: 683582232dc57aec88079d4a, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:13:49 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "683582232dc57aec88079d4a"}}  108
2025-05-27 17:13:49 INFO MongoDB连接已关闭  87
2025-05-27 17:13:49 INFO MongoDB 数据: None  76
2025-05-27 17:13:49 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:13:49 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 100, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.054699998349, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:20Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 8}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:20Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:13:44.484Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 100, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337260, \"i\": 12}}..."}  108
2025-05-27 17:13:49 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:13:49 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "driverConnectionId": 1, "serverConnectionId": 78, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.5301000201143324, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337258, \"i\": 20}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337258, \"i\": 20}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:12:53.337Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 78, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:13:49 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:13:49 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:13:50 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "683582232dc57aec88079d4a"}, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 500.17419998766854, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:13:50 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKzeaEwpxwC HTTP/1.1" 200 109  544
2025-05-27 17:13:50 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:13:50 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data9]  18
2025-05-27 17:13:50 INFO 测试结果：failed  19
2025-05-27 17:13:50 INFO 故障表示：test_data = {'Expected_result': '37.000', 'Mysql/Mongo': 'BTAvg', 'Title': '集群-单体平均温度值', 'address': '41', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:13:50 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:13:50 INFO 用例耗时：43.444985800015274  22
2025-05-27 17:13:50 INFO **************************************  23
2025-05-27 17:13:50 DEBUG Connection to Modbus server established. Socket ('127.0.0.1', 49367)  195
2025-05-27 17:13:50 DEBUG Processing: 0x0 0x1 0x0 0x0 0x0 0x6 0x1 0x6 0x0 0x2e 0x4e 0x78  91
2025-05-27 17:13:50 DEBUG decoded PDU function_code(6 sub -1) -> WriteSingleRegisterResponse(dev_id=0, transaction_id=0, address=46, count=0, bits=[], registers=[20088], status=1)   113
2025-05-27 17:13:50 DEBUG Frame advanced, resetting header!!  101
2025-05-27 17:13:50 INFO Modbus 数据: None  67
2025-05-27 17:13:50 DEBUG {"message": "Starting topology monitoring", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}}  108
2025-05-27 17:13:50 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "previousDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:13:50 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:50 DEBUG {"message": "Starting server monitoring", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:50 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:13:50 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:13:50 DEBUG {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}}  108
2025-05-27 17:13:50 DEBUG {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "remainingTimeMS": 29999}  108
2025-05-27 17:14:10 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverHost": "rs-01", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:14:10 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 139, "serverHost": "rs-01", "serverPort": 27017, "awaited": false, "durationMS": 0.5973000079393387, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"ismaster\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337281, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:41Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337281, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:41Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:14:41.576Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 139, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337281, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": ..."}  108
2025-05-27 17:14:10 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:10 DEBUG {"message": "Connection pool created", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:14:10 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "previousDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: Unknown, servers: [<ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:14:10 DEBUG {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:10 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:10 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 139, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:14:10 DEBUG {"message": "Connection created", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:14:13 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverHost": "rs-02", "serverPort": 27017, "awaited": false}  108
2025-05-27 17:14:13 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 102, "serverHost": "rs-02", "serverPort": 27017, "awaited": false, "durationMS": 0.6131000118330121, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337283, \"i\": 12}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:43Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337283, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:43Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:14:07.927Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 102, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337283, \"i\": 12}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 174..."}  108
2025-05-27 17:14:13 DEBUG {"message": "Connection pool ready", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:14:13 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "previousDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0006131000118330121>]>"}  108
2025-05-27 17:14:13 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 102, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:14:20 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 139, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.696100014262, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337291, \"i\": 10}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:51Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337291, \"i\": 10}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:51Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:14:51.579Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 139, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337291, \"i\": 10}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}..."}  108
2025-05-27 17:14:20 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 139, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:14:23 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 102, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 10001.24430001597, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c43e3096e5d48a73e6cd\"}, \"counter\": 4}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"secondary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-02:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337293, \"i\": 18}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:14:53Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337293, \"i\": 12}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:14:53Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:14:17.929Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 102, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337293, \"i\": 18}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337293, \"i\": 18}..."}  108
2025-05-27 17:14:23 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 102, "serverHost": "rs-02", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:14:30 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 139, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 9999.407100025564, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"6833c45a784581ead27a276c\"}, \"counter\": 6}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"isWritablePrimary\": true, \"primary\": \"RS-01:27017\", \"me\": \"RS-01:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000002\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:15:01Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:15:01Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:15:01.579Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 139, \"maxWireVersion\": 13, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"..."}  108
2025-05-27 17:14:30 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 139, "serverHost": "rs-01", "serverPort": 27017, "awaited": true}  108
2025-05-27 17:14:30 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverHost": "ems-02", "serverPort": 27018, "awaited": false}  108
2025-05-27 17:14:30 DEBUG {"message": "Server heartbeat succeeded", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 80, "serverHost": "ems-02", "serverPort": 27018, "awaited": false, "durationMS": 0.8221000025514513, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"6833c41b8c9f52adc5212d64\"}, \"counter\": 2}, \"hosts\": [\"RS-01:27017\", \"RS-02:27017\"], \"arbiters\": [\"EMS-02:27018\"], \"setName\": \"testrs\", \"setVersion\": 4, \"primary\": \"RS-01:27017\", \"arbiterOnly\": true, \"me\": \"EMS-02:27018\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337300, \"i\": 14}}, \"t\": 2}, \"lastWriteDate\": {\"$date\": \"2025-05-27T09:15:00Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1748337300, \"i\": 14}}, \"t\": 2}, \"majorityWriteDate\": {\"$date\": \"2025-05-27T09:15:00Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-05-27T09:13:34.531Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 80, \"maxWireVersion\": 13, \"ok\": 1.0}"}  108
2025-05-27 17:14:30 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "previousDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0006131000118330121>]>", "newDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0008221000025514513>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0006131000118330121>]>"}  108
2025-05-27 17:14:30 DEBUG {"message": "Server heartbeat started", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "driverConnectionId": 1, "serverConnectionId": 80, "serverHost": "ems-02", "serverPort": 27018, "awaited": true}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection ready", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0007235000084619969}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 20.006015000020852}  108
2025-05-27 17:14:30 DEBUG {"message": "Command started", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "command": "{\"find\": \"RackDetail_TK4620417001-1\", \"sort\": {\"Getdatetime\": -1}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"Ik+e1namTbOzQLMbmwvXAw==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"emsData_analyze\"}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 21726, "operationId": 21726, "driverConnectionId": 1, "serverConnectionId": 141, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "durationMS": 0.622, "reply": "{\"cursor\": {\"ns\": \"emsData_analyze.RackDetail_TK4620417001-1\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}}", "commandName": "find", "databaseName": "emsData_analyze", "requestId": 21726, "operationId": 21726, "driverConnectionId": 1, "serverConnectionId": 141, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:14:30 DEBUG {"message": "Server selection started", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0008221000025514513>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0006131000118330121>]>", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}}  108
2025-05-27 17:14:30 DEBUG {"message": "Server selection succeeded", "selector": "PrimaryPreferred(tag_sets=None, max_staleness=-1, hedge=None)", "operation": "endSessions", "topologyDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0008221000025514513>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0006131000118330121>]>", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection checkout started", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection checked out", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 9.40999889280647e-05}  108
2025-05-27 17:14:30 DEBUG {"message": "Command started", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "command": "{\"endSessions\": [{\"id\": {\"$binary\": {\"base64\": \"Ik+e1namTbOzQLMbmwvXAw==\", \"subType\": \"04\"}}}], \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"$db\": \"admin\", \"$readPreference\": {\"mode\": \"primaryPreferred\"}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 14771, "operationId": 14771, "driverConnectionId": 1, "serverConnectionId": 141, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Command succeeded", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "durationMS": 0.439, "reply": "{\"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"subType\": \"00\"}}}}, \"operationTime\": {\"$timestamp\": {\"t\": 1748337301, \"i\": 8}}}", "commandName": "endSessions", "databaseName": "admin", "requestId": 14771, "operationId": 14771, "driverConnectionId": 1, "serverConnectionId": 141, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection checked in", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1}  108
2025-05-27 17:14:30 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-02", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection closed", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017, "driverConnectionId": 1, "reason": "Connection pool was closed", "error": "poolClosed"}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017}  108
2025-05-27 17:14:30 DEBUG {"message": "Stopped server monitoring", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:14:30 DEBUG {"message": "Connection pool closed", "clientId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "ems-02", "serverPort": 27018}  108
2025-05-27 17:14:30 DEBUG {"message": "Topology description changed", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "previousDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: RSArbiter, rtt: 0.0008221000025514513>, <ServerDescription ('rs-01', 27017) server_type: RSPrimary, rtt: 0.0005973000079393387>, <ServerDescription ('rs-02', 27017) server_type: RSSecondary, rtt: 0.0006131000118330121>]>", "newDescription": "<TopologyDescription id: 6835824e2dc57aec88079d4b, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ems-02', 27018) server_type: Unknown, rtt: None>, <ServerDescription ('rs-01', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('rs-02', 27017) server_type: Unknown, rtt: None>]>"}  108
2025-05-27 17:14:30 DEBUG {"message": "Stopped topology monitoring", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}}  108
2025-05-27 17:14:30 INFO MongoDB连接已关闭  87
2025-05-27 17:14:30 INFO MongoDB 数据: None  76
2025-05-27 17:14:30 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:14:30 DEBUG https://open.feishu.cn:443 "POST /open-apis/auth/v3/tenant_access_token/internal HTTP/1.1" 200 102  544
2025-05-27 17:14:30 DEBUG Starting new HTTPS connection (1): open.feishu.cn:443  1049
2025-05-27 17:14:31 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-02", "serverPort": 27017, "awaited": true, "durationMS": 8006.658099999186, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:14:31 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "rs-01", "serverPort": 27017, "awaited": true, "durationMS": 500.25250000180677, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:14:31 DEBUG {"message": "Server heartbeat failed", "topologyId": {"$oid": "6835824e2dc57aec88079d4b"}, "serverHost": "ems-02", "serverPort": 27018, "awaited": true, "durationMS": 500.2385000116192, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 1}  108
2025-05-27 17:14:32 DEBUG https://open.feishu.cn:443 "PUT /open-apis/bitable/v1/apps/YLnMbpF04adU1es17Psc9fGgn4g/tables/tblK5e7kvbMprrws/records/recuKA7ppsdeuf HTTP/1.1" 200 109  544
2025-05-27 17:14:32 INFO MongoDB 数据写入成功: None  79
2025-05-27 17:14:32 INFO 用例ID：testcase/test_run1.py::test_modbus_and_mongodb[test_data10]  18
2025-05-27 17:14:32 INFO 测试结果：failed  19
2025-05-27 17:14:32 INFO 故障表示：test_data = {'Expected_result': '88.000', 'Mysql/Mongo': 'Bcp', 'Title': '集群-系统功率', 'address': '46', ...}

    @pytest.mark.parametrize("test_data", test_data())
    def test_modbus_and_mongodb(test_data):
    
        # 测试逻辑
        ip = test_data.get("ip")
        port = test_data.get("port")
        address = int(test_data.get("address"))
        count = test_data.get("count")
        slave = test_data.get("slave")
        function_code = test_data.get("function_code")
        write_value = test_data.get("write_value")
        datatype = test_data.get("datatype")
        dataformat = test_data.get("dataformat")
        query_params = test_data.get("query_params")
        collection = test_data.get("collection")
        expected_result = test_data.get("Expected_result")
        record_id = test_data.get("record_id")
        dynamic_title(test_data)
        try:
            # 写入modbus数据
            modbus_data = ProcessModbusData(ip, port, address, count, slave, function_code, write_value, datatype, dataformat).write_modbus_register()
            modbus_logger.info(f"Modbus 数据: {modbus_data}")
        except Exception as e:
            modbus_logger.error(f"Modbus 数据写入失败: {e}")
            pytest.fail("Modbus 数据写入失败")
    
        try:
            # 获取mongodb数据
            mg_data = ProcessMongodbData().get_mongodb_value(query_params, collection)
            print(f"mg_data: {mg_data}")
            db_logger.info(f"MongoDB 数据: {mg_data}")
            # mongodb获取结果更新到飞书
            feishu_test_case.updata_bitable_data(record_id, "Mongomysqlresult", mg_data)
            db_logger.info(f"MongoDB 数据写入成功: {mg_data}")
            print(f"预期结果：{expected_result}，mongo提取结果{mg_data}")
            print(type(expected_result))
            print(type(mg_data))
        except Exception as e:
            db_logger.error(f"MongoDB 数据获取失败: {e}")
            pytest.fail("MongoDB 数据获取失败")
    
>       if float(expected_result) == float(mg_data):
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

testcase\test_run1.py:87: TypeError  20
2025-05-27 17:14:32 INFO 异常：<ExceptionInfo TypeError("float() argument must be a string or a real number, not 'NoneType'") tblen=1>  21
2025-05-27 17:14:32 INFO 用例耗时：41.21036999998614  22
2025-05-27 17:14:32 INFO **************************************  23
